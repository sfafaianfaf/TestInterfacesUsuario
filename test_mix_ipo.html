<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPO ¬∑ Test MIX (66% T1-3 ¬∑ 34% T4-6)</title>

  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#9aa4b2; --text:#e7eefc;
      --accent:#6ea8fe; --ok:#22c55e; --bad:#ef4444; --warn:#f59e0b; --border:#24304a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #132044 0%, var(--bg) 60%);
      color:var(--text); line-height:1.35;
    }
    .wrap{max-width:980px; margin:0 auto; padding:24px 16px 48px;}
    header{display:flex; justify-content:space-between; gap:12px; align-items:flex-end; flex-wrap:wrap; margin-bottom:14px;}
    h1{font-size:20px; margin:0; letter-spacing:.2px;}
    .sub{color:var(--muted); font-size:13px; margin-top:6px;}
    .pill{
      display:inline-flex; gap:10px; align-items:center;
      padding:8px 12px; border:1px solid var(--border);
      border-radius:999px; background: rgba(18,26,43,.7);
      color:var(--muted); font-size:13px;
    }
    .menuBtn{
      display:inline-flex; align-items:center; gap:8px;
      text-decoration:none;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(110,168,254,.55);
      background: rgba(110,168,254,.12);
      color: #e7eefc;
      font-weight:800;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .menuBtn:hover{background: rgba(110,168,254,.18); transform: translateY(-1px);}
    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(18,26,43,.92), rgba(18,26,43,.7));
      border-radius:16px; padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .row{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;}
    .progress{width:100%; height:10px; border-radius:999px; background:#0e1628; border:1px solid var(--border); overflow:hidden; margin-top:10px;}
    .bar{height:100%; width:0%; background: linear-gradient(90deg, var(--accent), #8b5cf6); border-radius:999px; transition: width .25s ease;}
    .q{font-size:18px; margin:14px 0 10px;}
    .topic{color:var(--muted); font-size:13px;}
    .opts{display:grid; gap:10px; margin-top:8px;}
    label.opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px; border-radius:12px;
      border:1px solid var(--border); background: rgba(11,18,32,.45);
      cursor:pointer;
      transition: transform .06s ease, border-color .15s ease, background .15s ease;
    }
    label.opt:hover{transform: translateY(-1px); border-color: rgba(110,168,254,.55); background: rgba(110,168,254,.08);}
    input[type="radio"]{margin-top:3px; accent-color: var(--accent); transform: scale(1.05);}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}
    button{
      border:1px solid var(--border); background: rgba(11,18,32,.55);
      color:var(--text); padding:10px 12px; border-radius:12px;
      cursor:pointer; font-weight:800; letter-spacing:.2px;
      transition: background .15s ease, transform .06s ease, border-color .15s ease;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(110,168,254,.55); background: rgba(110,168,254,.10);}
    button.primary{border-color: rgba(110,168,254,.7); background: rgba(110,168,254,.16);}
    button.danger{border-color: rgba(239,68,68,.65); background: rgba(239,68,68,.10);}
    button.ok{border-color: rgba(34,197,94,.65); background: rgba(34,197,94,.10);}
    button:disabled{opacity:.45; cursor:not-allowed; transform:none;}
    .feedback{
      margin-top:12px; padding:12px; border-radius:12px;
      border:1px solid var(--border); background: rgba(11,18,32,.45);
      display:none;
    }
    .feedback.ok{border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.10)}
    .feedback.bad{border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.10)}
    .feedback.warn{border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.10)}
    .small{color:var(--muted); font-size:13px; margin-top:8px;}
    .setup{display:block;}
    .quiz{display:none;}
    .summary{display:none; margin-top:14px;}
    .grid{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px; margin-top:12px;}
    .kpi{padding:12px; border-radius:14px; border:1px solid var(--border); background: rgba(11,18,32,.45);}
    .kpi .n{font-size:22px; font-weight:900; margin-bottom:4px}
    .kpi .t{color:var(--muted); font-size:13px}
    @media (max-width:740px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    details.reviewItem{
      border:1px solid var(--border); border-radius:14px; background: rgba(11,18,32,.35);
      padding:10px 12px; margin:10px 0;
    }
    details.reviewItem summary{cursor:pointer; font-weight:800;}
    .tag{display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:12px; margin-left:8px;}
    .divider{height:1px; background: rgba(36,48,74,.8); margin:12px 0;}
    input[type="number"]{
      width:140px; padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background: rgba(11,18,32,.55); color: var(--text); font-weight:800; outline:none;
    }
    select{
      padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background: rgba(11,18,32,.55); color: var(--text); font-weight:700; outline:none;
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div>
      <h1>Test MIX ¬∑ IPO</h1>
      <div class="sub">
        Genera un test aleatorio mezclando temas:
        <b>‚âà66%</b> de (Tema 1‚Äì3) y <b>‚âà34%</b> de (Tema 4‚Äì6).<br/>
        Puntuaci√≥n: +1 correcta ¬∑ ‚àí1/3 incorrecta ¬∑ 0 en blanco.
      </div>
    </div>
    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
      <a class="menuBtn" href="index.html">üè† Men√∫</a>
      <div class="pill">Preg. <b id="qNum">0</b>/<span id="qTotal">0</span> ¬∑ Nota: <b id="scoreNow">0.00</b></div>
    </div>
  </header>

  <div class="card">
    <!-- SETUP -->
    <div class="setup" id="setup">
      <div class="row">
        <div>
          <div style="font-size:16px; font-weight:900;">Configura tu test MIX</div>
          <div class="small">
            Esto carga autom√°ticamente los bancos desde tus HTML de temas.
            Si algo da 404, revisa nombres exactos (may√∫sculas/min√∫sculas).
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row" style="align-items:flex-end;">
        <div>
          <div class="small" style="margin:0 0 6px;">N√∫mero de preguntas (N)</div>
          <input type="number" id="numQuestions" min="10" max="60" value="30" />
          <div class="small">M√°ximo recomendado aqu√≠: 60.</div>
        </div>

        <div>
          <div class="small" style="margin:0 0 6px;">Modo</div>
          <select id="modeSelect">
            <option value="instant">Feedback al confirmar</option>
            <option value="exam">Modo examen (feedback solo al final)</option>
          </select>
        </div>

        <div class="actions" style="margin-top:0;">
          <button class="primary" id="btnLoad">Cargar bancos</button>
          <button class="primary" id="btnStart" disabled>Empezar</button>
          <button class="danger" id="btnHardReset">Reset</button>
        </div>
      </div>

      <div class="small" id="setupNote"></div>
    </div>

    <!-- QUIZ -->
    <div class="quiz" id="quiz">
      <div class="row">
        <div class="topic" id="topicTag"></div>
        <div class="topic">
          Confirmadas: <b id="doneCount">0</b> ¬∑ Correctas: <b id="okCount">0</b> ¬∑ Incorrectas: <b id="badCount">0</b> ¬∑ En blanco: <b id="blankCount">0</b>
        </div>
      </div>

      <div class="progress" aria-label="Progreso">
        <div class="bar" id="bar"></div>
      </div>

      <div class="q" id="questionText"></div>
      <div class="opts" id="options"></div>

      <div class="actions">
        <button id="btnPrev">‚¨ÖÔ∏è Anterior</button>
        <button id="btnNext">Siguiente ‚û°Ô∏è</button>
        <button class="ok" id="btnConfirm">Confirmar / Puntuar</button>
        <button id="btnSkip">Dejar en blanco</button>
        <button class="danger" id="btnFinish">Finalizar test</button>
      </div>

      <div class="feedback" id="feedbackBox"></div>
      <div class="small" id="hintText"></div>

      <!-- SUMMARY -->
      <div class="summary" id="summary">
        <h2 style="margin:14px 0 8px; font-size:18px;">Resultado final</h2>
        <div class="grid">
          <div class="kpi"><div class="n" id="finalScore">0.00</div><div class="t">Nota (penaliza 1/3)</div></div>
          <div class="kpi"><div class="n" id="finalOk">0</div><div class="t">Correctas</div></div>
          <div class="kpi"><div class="n" id="finalBad">0</div><div class="t">Incorrectas</div></div>
          <div class="kpi"><div class="n" id="finalBlank">0</div><div class="t">En blanco</div></div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div style="font-weight:900;">Revisi√≥n pregunta por pregunta</div>
          <div class="actions" style="margin-top:0;">
            <button id="btnExpandAll">Expandir todo</button>
            <button id="btnCollapseAll">Contraer todo</button>
            <button class="primary" id="btnBackToSetup">Hacer otro test</button>
          </div>
        </div>

        <div id="reviewList"></div>
      </div>
    </div>
  </div>
</div>

<script>
  // --- Anti ‚Äúdoble salto‚Äù (m√≥vil)
  function onTap(el, fn){
    let lock = 0;
    el.addEventListener("click", (e)=>{
      e.preventDefault();
      const now = Date.now();
      if(now - lock < 300) return;
      lock = now;
      fn();
    }, {passive:false});
  }

  const NEG = 1/3;
  const ABCD = (i) => String.fromCharCode(65+i);
  function fmt(n){ return (Math.round(n*100)/100).toFixed(2); }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  // ---- Cargar BANK desde un HTML (busca: const BANK = [ ... ])
  function extractBankArrayLiteral(html){
    // ‚úÖ FIX: aqu√≠ NO van dobles backslashes
    const m = html.match(/const\s+BANK\s*=\s*\[/);
    if(!m) return null;

    // desde el primer '[' que aparece despu√©s del match
    const start = html.indexOf("[", m.index);
    if(start < 0) return null;

    let i = start;
    let depth = 0;
    let str = null;
    let esc = false;

    while(i < html.length){
      const ch = html[i];

      if(str){
        if(esc){ esc = false; }
        else if(ch === "\\"){ esc = true; }
        else if(ch === str){ str = null; }
      }else{
        if(ch === "'" || ch === '"' || ch === "`"){ str = ch; }
        else if(ch === "["){ depth++; }
        else if(ch === "]"){
          depth--;
          if(depth === 0){
            return html.slice(start, i+1);
          }
        }
      }
      i++;
    }
    return null;
  }

  async function loadBankFromFile(file){
    const res = await fetch(file, {cache:"no-store"});
    if(!res.ok) throw new Error(`No se pudo cargar ${file} (${res.status})`);
    const txt = await res.text();
    const arr = extractBankArrayLiteral(txt);
    if(!arr) throw new Error(`No encontr√© "const BANK = [...]" en ${file}`);

    // Convierte "[{...}]" a array real (los objetos son literales JS)
    const raw = Function("return " + arr)();

    // Normaliza: {topic, q, options, a, exp}
    return raw.map(item=>{
      const topic = item.topic ?? item.tema ?? item.t ?? "";
      const q = item.q ?? item.p ?? item.question ?? item.enunciado ?? "";
      const options = item.options ?? item.opts ?? item.opciones ?? [];
      const a =
        (typeof item.a === "number") ? item.a :
        (typeof item.correct === "number") ? item.correct :
        (typeof item.c === "number") ? item.c :
        0;
      const exp = item.exp ?? item.e ?? item.explain ?? "";
      return { topic, q, options, a, exp };
    }).filter(x => x.q && Array.isArray(x.options) && x.options.length >= 4);
  }

  // ---- Estado del MIX
  let BANK_A = []; // temas 1-3 (66%)
  let BANK_B = []; // temas 4-6 (34%)
  let LOADED = false;

  // ---- Estado de sesi√≥n
  let session = [];
  let idx = 0;
  let answers = [];
  let mode = "instant";

  // ---- DOM
  const qNum = document.getElementById("qNum");
  const qTotal = document.getElementById("qTotal");
  const scoreNow = document.getElementById("scoreNow");

  const setupEl = document.getElementById("setup");
  const quizEl = document.getElementById("quiz");
  const summaryEl = document.getElementById("summary");

  const numQuestionsEl = document.getElementById("numQuestions");
  const modeSelectEl = document.getElementById("modeSelect");
  const setupNoteEl = document.getElementById("setupNote");

  const topicTagEl = document.getElementById("topicTag");
  const questionTextEl = document.getElementById("questionText");
  const optionsEl = document.getElementById("options");
  const feedbackBoxEl = document.getElementById("feedbackBox");
  const hintTextEl = document.getElementById("hintText");

  const doneCountEl = document.getElementById("doneCount");
  const okCountEl = document.getElementById("okCount");
  const badCountEl = document.getElementById("badCount");
  const blankCountEl = document.getElementById("blankCount");
  const barEl = document.getElementById("bar");

  const finalScoreEl = document.getElementById("finalScore");
  const finalOkEl = document.getElementById("finalOk");
  const finalBadEl = document.getElementById("finalBad");
  const finalBlankEl = document.getElementById("finalBlank");
  const reviewListEl = document.getElementById("reviewList");

  const btnLoad = document.getElementById("btnLoad");
  const btnStart = document.getElementById("btnStart");
  const btnHardReset = document.getElementById("btnHardReset");

  const btnPrev = document.getElementById("btnPrev");
  const btnNext = document.getElementById("btnNext");
  const btnConfirm = document.getElementById("btnConfirm");
  const btnSkip = document.getElementById("btnSkip");
  const btnFinish = document.getElementById("btnFinish");

  const btnExpandAll = document.getElementById("btnExpandAll");
  const btnCollapseAll = document.getElementById("btnCollapseAll");
  const btnBackToSetup = document.getElementById("btnBackToSetup");

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  }

  function resetAll(){
    session = [];
    idx = 0;
    answers = [];
    mode = modeSelectEl.value;

    quizEl.style.display = "none";
    summaryEl.style.display = "none";
    setupEl.style.display = "block";

    qNum.textContent = "0";
    qTotal.textContent = "0";
    scoreNow.textContent = "0.00";
    setupNoteEl.textContent = LOADED ? "Bancos cargados. Dale a Empezar." : "Pulsa ‚ÄúCargar bancos‚Äù.";
  }

  function compute(){
    let ok=0,bad=0,blank=0,done=0,score=0;
    answers.forEach(a=>{
      if(!a.graded) return;
      done++;
      if(a.isBlank) blank++;
      else if(a.isCorrect) ok++;
      else bad++;
      score += a.points;
    });
    return {ok,bad,blank,done,score};
  }

  function updateHeader(){
    qNum.textContent = String(session.length ? (idx+1) : 0);
    qTotal.textContent = String(session.length || 0);
    const s = compute();
    scoreNow.textContent = fmt(s.score);

    doneCountEl.textContent = s.done;
    okCountEl.textContent = s.ok;
    badCountEl.textContent = s.bad;
    blankCountEl.textContent = s.blank;

    const pct = session.length ? Math.round(((idx+1)/session.length)*100) : 0;
    barEl.style.width = pct + "%";
  }

  function render(){
    const item = session[idx];
    topicTagEl.textContent = item.topic || "MIX";

    questionTextEl.textContent = item.q;

    optionsEl.innerHTML = "";
    const name = "q_" + idx;

    item.options.forEach((opt, i)=>{
      const lab = document.createElement("label");
      lab.className = "opt";
      lab.innerHTML = `
        <input type="radio" name="${name}" value="${i}">
        <div><b>${ABCD(i)})</b> ${escapeHtml(opt)}</div>
      `;
      optionsEl.appendChild(lab);
    });

    if(answers[idx].sel !== null){
      const r = optionsEl.querySelector(\`input[value="\${answers[idx].sel}"]\`);
      if(r) r.checked = true;
    }

    feedbackBoxEl.style.display = "none";
    feedbackBoxEl.className = "feedback";
    hintTextEl.textContent = (mode === "exam")
      ? "Modo examen: no hay feedback hasta el final."
      : "Puedes confirmar para puntuar, o dejar en blanco.";

    btnPrev.disabled = (idx===0);
    btnNext.disabled = (idx===session.length-1);

    updateHeader();
  }

  function saveSelection(){
    const checked = optionsEl.querySelector('input[type="radio"]:checked');
    answers[idx].sel = checked ? parseInt(checked.value,10) : null;
  }

  function gradeCurrent(forceBlank){
    const item = session[idx];
    const a = answers[idx];

    if(forceBlank){
      a.sel = null;
    }else{
      saveSelection();
    }

    a.graded = true;
    a.isBlank = (a.sel === null);

    if(a.isBlank){
      a.isCorrect = false;
      a.points = 0;
      if(mode !== "exam"){
        feedbackBoxEl.className = "feedback warn";
        feedbackBoxEl.style.display = "block";
        feedbackBoxEl.innerHTML = `<b>En blanco</b><div class="small">No suma ni resta. Correcta: <b>${ABCD(item.correct)})</b> ${escapeHtml(item.options[item.correct])}</div>`;
      }
    }else{
      a.isCorrect = (a.sel === item.correct);
      a.points = a.isCorrect ? 1 : (-NEG);

      if(mode !== "exam"){
        feedbackBoxEl.className = "feedback " + (a.isCorrect ? "ok" : "bad");
        feedbackBoxEl.style.display = "block";
        feedbackBoxEl.innerHTML = `
          <b>${a.isCorrect ? "Correcta ‚úÖ" : "Incorrecta ‚ùå"}</b>
          <div class="small">
            Correcta: <b>${ABCD(item.correct)})</b> ${escapeHtml(item.options[item.correct])}
            ${item.exp ? `<br>${escapeHtml(item.exp)}` : ""}
          </div>
        `;
      }
    }
    updateHeader();
  }

  function finish(){
    summaryEl.style.display = "block";

    const s = compute();
    finalScoreEl.textContent = fmt(s.score);
    finalOkEl.textContent = s.ok;
    finalBadEl.textContent = s.bad;
    finalBlankEl.textContent = s.blank;

    reviewListEl.innerHTML = "";
    session.forEach((item, i)=>{
      const a = answers[i];
      const status = !a.graded ? "Sin confirmar" : (a.isBlank ? "En blanco" : (a.isCorrect ? "Correcta" : "Incorrecta"));
      const pts = !a.graded ? "0.00" : fmt(a.points);

      const your = (!a.graded || a.sel===null) ? "‚Äî" : `${ABCD(a.sel)}) ${item.options[a.sel]}`;
      const cor = `${ABCD(item.correct)}) ${item.options[item.correct]}`;

      const det = document.createElement("details");
      det.className = "reviewItem";
      det.innerHTML = `
        <summary>Pregunta ${i+1}: ${escapeHtml(status)} <span class="tag">${pts} pts</span></summary>
        <div class="small" style="margin-top:8px;"><b>Tema:</b> ${escapeHtml(item.topic || "MIX")}</div>
        <div class="small" style="margin-top:6px;"><b>Enunciado:</b> ${escapeHtml(item.q)}</div>
        <div class="small" style="margin-top:6px;"><b>Tu respuesta:</b> ${escapeHtml(your)}</div>
        <div class="small" style="margin-top:6px;"><b>Correcta:</b> ${escapeHtml(cor)}</div>
        ${item.exp ? `<div class="small" style="margin-top:6px;"><b>Nota:</b> ${escapeHtml(item.exp)}</div>` : ""}
      `;
      reviewListEl.appendChild(det);
    });
  }

  // --- Construye MIX 66/34 usando TODO el banco (T1-3) vs (T4-6)
  function buildSession(N){
    const n = Math.max(10, Math.min(60, parseInt(N,10) || 30));
    mode = modeSelectEl.value;

    let nA = Math.round(n * 0.66);
    let nB = n - nA;

    nA = Math.min(nA, BANK_A.length);
    nB = Math.min(nB, BANK_B.length);

    let total = nA + nB;
    if(total < n){
      const missing = n - total;
      const canA = BANK_A.length - nA;
      const addA = Math.min(missing, Math.max(0, canA));
      nA += addA;
      total += addA;

      const missing2 = n - total;
      const canB = BANK_B.length - nB;
      const addB = Math.min(missing2, Math.max(0, canB));
      nB += addB;
    }

    const A = shuffle(BANK_A.slice()).slice(0, nA);
    const B = shuffle(BANK_B.slice()).slice(0, nB);
    const picked = shuffle(A.concat(B));

    // baraja opciones y recalcula √≠ndice de correcta
    session = picked.map(item=>{
      const opts = item.options.map((txt, i)=>({txt, i}));
      shuffle(opts);
      const correct = opts.findIndex(o => o.i === item.a);
      return {
        topic: item.topic,
        q: item.q,
        options: opts.map(o=>o.txt),
        correct,
        exp: item.exp || ""
      };
    });

    answers = session.map(()=>({sel:null, graded:false, isBlank:true, isCorrect:false, points:0}));

    idx = 0;
    quizEl.style.display = "block";
    setupEl.style.display = "none";
    summaryEl.style.display = "none";
    render();
  }

  // --- Eventos
  onTap(btnHardReset, ()=> resetAll());
  onTap(btnPrev, ()=>{ saveSelection(); if(idx>0){ idx--; render(); } });
  onTap(btnNext, ()=>{ saveSelection(); if(idx<session.length-1){ idx++; render(); } });
  onTap(btnConfirm, ()=> gradeCurrent(false));
  onTap(btnSkip, ()=> gradeCurrent(true));
  onTap(btnFinish, ()=> finish());
  onTap(btnExpandAll, ()=> document.querySelectorAll("details.reviewItem").forEach(d=>d.open=true));
  onTap(btnCollapseAll, ()=> document.querySelectorAll("details.reviewItem").forEach(d=>d.open=false));
  onTap(btnBackToSetup, ()=> resetAll());

  onTap(btnLoad, async ()=>{
    setupNoteEl.textContent = "Cargando bancos‚Ä¶";

    try{
      const [b1,b2,b3,b4,b5,b6] = await Promise.all([
        loadBankFromFile("test_tema1_ipo.html"),
        loadBankFromFile("test_tema2_ipo.html"),
        loadBankFromFile("test_tema3_ipo.html"),
        loadBankFromFile("test_tema4_ipo.html"),
        loadBankFromFile("test_tema5_ipo.html"),
        loadBankFromFile("test_tema6_ipo.html"),
      ]);

      // ‚úÖ TODO el banco por grupos
      BANK_A = []
        .concat(b1.map(x=>({...x, topic: x.topic || "Tema 1"})))
        .concat(b2.map(x=>({...x, topic: x.topic || "Tema 2"})))
        .concat(b3.map(x=>({...x, topic: x.topic || "Tema 3"})));

      BANK_B = []
        .concat(b4.map(x=>({...x, topic: x.topic || "Tema 4"})))
        .concat(b5.map(x=>({...x, topic: x.topic || "Tema 5"})))
        .concat(b6.map(x=>({...x, topic: x.topic || "Tema 6"})));

      LOADED = true;
      btnStart.disabled = false;
      setupNoteEl.textContent = `OK: cargado. Banco MIX = ${BANK_A.length} (T1-3) + ${BANK_B.length} (T4-6). Ya puedes empezar.`;
    }catch(err){
      LOADED = false;
      btnStart.disabled = true;
      setupNoteEl.textContent = "ERROR: " + err.message;
    }
  });

  onTap(btnStart, ()=>{
    if(!LOADED){
      setupNoteEl.textContent = "Primero pulsa ‚ÄúCargar bancos‚Äù.";
      return;
    }
    buildSession(numQuestionsEl.value);
  });

  // init
  resetAll();
</script>
</body>
</html>
